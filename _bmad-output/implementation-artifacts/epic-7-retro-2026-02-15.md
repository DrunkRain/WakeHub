# Rétrospective — Epic 7 : Monitoring Réseau Avancé

Date : 2026-02-15
Facilitateur : Bob (Scrum Master)
Participants : Alice (PO), Charlie (Senior Dev), Dana (QA), Elena (Junior Dev), Drunkrain (Project Lead)

## Contexte

- Epic 7 : dernière epic du MVP WakeHub
- 2 stories : 7.1 (Docker delta trafic) + 7.2 (Proxmox rrddata)
- Première rétrospective du projet
- Pas d'epic suivante définie (fin du roadmap MVP)
- **MVP complet : 7 epics, 56/56 FRs, 632 tests**

## Epic 7 — Métriques

| Métrique | Valeur |
|---|---|
| Stories complétées | 2/2 (100%) |
| Tests ajoutés | 24 (20 backend + 4 frontend) |
| Total tests projet | 632 (406 serveur + 226 web) |
| TypeScript | Clean (server + web) |
| Code review findings | 7 (1 HIGH, 2 MEDIUM, 4 LOW) — tous corrigés |
| Dette technique nouvelle | 0 |
| FRs livrés | FR55, FR56 |

## Ce qui a bien fonctionné

### Stories très bien documentées
Les Dev Notes de la Story 7.1 incluaient des snippets de code précis, les pièges à éviter, et des références exactes aux lignes de code. Résultat : implémentation fluide, zéro blocage.

### Design extensible
La fonction `checkNetworkTraffic()` implémentée en 7.1 a été réutilisée telle quelle pour Proxmox en 7.2. Seule la condition d'entrée dans le monitor a été étendue (2 lignes). Le cache `networkTrafficCache` est générique par design.

### Décision architecturale solide (7.2)
Utilisation de `/status/current` au lieu de `rrddata` pour les métriques Proxmox. `rrddata` retourne des taux (bytes/s), incompatibles avec la logique de delta cumulé. Cette décision a évité un bug fondamental.

### Code review adversariale efficace
Les deux reviews ont trouvé des vrais problèmes :
- Story 7.1 : guard contre delta négatif au reset Docker (HIGH), fichier hors scope modifié (MEDIUM)
- Story 7.2 : story "fantôme" détectée (tâches cochées sans code), test LXC manquant (MEDIUM), nom de test trompeur (MEDIUM), non-null assertions (LOW)

### MVP complet
56/56 FRs couverts, 632 tests passants, TypeScript strict, zéro dette technique nouvelle.

## Ce qui n'a pas bien fonctionné

### Story 7.2 "fantôme"
Lors de la première tentative, toutes les tâches de 7.2 ont été marquées complètes sans écrire une seule ligne de code. Cause : confusion humaine légitime — le Project Lead pensait que la story avait déjà été implémentée et a demandé de cocher les cases. Détecté uniquement grâce à la code review adversariale.

**Cause racine** : fatigue cognitive après l'enchaînement de 7 epics. Aucun garde-fou automatique ne vérifie qu'un changement de code réel existe avant de marquer une story done.

### Débordement de périmètre (7.1)
Le fichier `logs-page.tsx` a été modifié alors qu'il n'était pas dans le scope de la Story 7.1. Détecté et corrigé en code review.

### Charge concentrée sur la code review
Les deux problèmes majeurs de l'epic ont été détectés par la code review. C'est rassurant pour le process, mais ça concentre trop de responsabilité sur une seule étape.

## Insights clés

1. **La code review adversariale est indispensable** — elle a détecté une story fantôme et des erreurs de périmètre
2. **Des stories bien documentées = implémentation fluide** — les Dev Notes détaillées corrèlent directement avec le zéro-blocage
3. **Le design extensible paye** — `checkNetworkTraffic()` réutilisé tel quel entre Docker et Proxmox
4. **La fatigue cognitive est un risque réel** — après un enchaînement intensif, des garde-fous automatiques sont nécessaires

## Action Items

### Process

1. **Vérification git diff dans le workflow code review**
   Le reviewer doit vérifier qu'un `git diff` non-vide existe pour chaque fichier listé dans la story.
   - Owner : Bob (Scrum Master)
   - Critère : Le workflow code review inclut une étape explicite de vérification des changements réels

2. **Garde-fou dev : vérification de code avant completion**
   L'agent dev doit exécuter les tests ET vérifier que les fichiers listés ont été modifiés avant de marquer les tâches done.
   - Owner : Bob (Scrum Master)
   - Critère : Le workflow dev inclut une étape de validation automatique pré-completion

3. **Maintenir les Dev Notes détaillées**
   Snippets de code, pièges à éviter et références précises aux lignes doivent rester un standard.
   - Owner : Bob (Scrum Master)
   - Critère : Chaque future story inclut une section Dev Notes avec références concrètes

### Accords d'équipe

- La code review adversariale reste **obligatoire**
- Toute story done doit avoir des **tests qui passent** et un **diff non-vide** vérifié
- Le périmètre (File List) doit être respecté strictement — aucune modification hors scope

## Évaluation Readiness MVP

| Dimension | Statut |
|---|---|
| Tests & Qualité | 632 tests, 100% pass, TypeScript clean |
| Couverture FRs | 56/56 — complet |
| Dette technique | Aucune dette nouvelle |
| Stabilité codebase | Solide — patterns cohérents, extensible |
| UX identifié | Configuration inactivité à simplifier (v2) |

## Feedback produit pour v2

- **UX inactivité** : la configuration des règles d'inactivité (4 critères, seuils en pourcentage, seuil réseau en bytes) est techniquement correcte mais peu intuitive pour un utilisateur homelab. Pistes : presets par type de service, descriptions plus parlantes, simplification de l'interface.

## Bilan MVP

Le MVP WakeHub est **complet et fonctionnel** :
- 7 epics livrées, 56/56 FRs couverts
- 632 tests (406 serveur + 226 web), TypeScript strict
- Architecture à deux couches (arbre d'hébergement + graphe de dépendances)
- Dashboard temps réel avec SSE, cascades start/stop
- Monitoring d'inactivité avec arrêt automatique
- Monitoring réseau avancé (Docker + Proxmox)
- Logging enrichi avec page de diagnostic
